# MALWARE:
Conceptos de malware, APT, File Less, o cualquier artefacto que sean utiles para ejecutar acciones sobre equipos.

## Tipos de malware:
Todos hablan sobre tipos, pero... hoy en día en lo personal me gusta decirles caracteristicas o metodos, ya hoy en día la gran gran mayoria del malware conjugan varios tipos.

## Componentes de malware:
- Crypter: Cifrador
- Downloader: Descarga malware de sitios externos.
- Dropper: Lanzar nuevo malware embebido dentro del codigo inicial.
- Exploit: Abusar de software vulnerable
- Injector: Inyectar codigo en otros procesos corriendo.
- Obfuscator: Proceso de dificultar la actividad, por ejemplo compresión usado por ufx.
- Packer: Compactar varios codigos maliciosos en uno solo, un ejemplo simple es la compresión de winrar que permite especificar que exe correran al abrir.
- Payload: Pieza especifica del malware que pemite control del equipo, puede ser una reverse shell, o simplemente correr un "net user /add"
- Malicious code:

## Malware en la linea gris PUA (potential unwanted software):
Malware que en si no es malicioso o si pero en pequeñas proporciones, pero que a la larga presenta un riesgo potencialmente alto.

- Adware: Software que muestra ADs de forma indiscriminada, en una de esos AD puede ser malicioso o no, aumenta consumo de CPU y a podria robar información por medio de cookies.
- Torrent: Conexiones Per to Per de descarga siempre son potencialmente maliciosas.
- Marketing: Extraen información y patrones del equipo para venderlo a empresas de marketing.
- Cryptomining: Algunos software pueden contener modulos de minado, haciendo que una pequeña parte del CPU siempre este minando.
- Dialers: Hoy ya no es comun porque la conexión de telefono es independiente, pero antes usados para realizar llamadas masivas y aumentar el costo del servicio.

## Medios de propagación:

- Dispositivos extraibles:
Metodo comun pero requiere acceso fisico al equipo, por ejemplo una tecnica es Autorun, aunque normalmente en windows ya viene apagado.
```
[autorun]
open=setup.exe icon=setup.exe
```
- Browser and Email Software Bugs:
Uso de software con vulnerabilidades que abren directamente comunicación con servicios externos hace que su riesgo aumente, por ejemplo manejadores de correos como outlook o navegadores firefox y chrome.
- Insecure Patch management:
Mal manejo de parcheo de software interno del equipo, principalmente de servicios como apache, librerias de codigo, etc.
- Rogue/Decoy Applications:
Similar al comportamiento de un troyano, por ejemplo cuando de joven descargabas una pelicula o software que sabes debe ser ligero y termina pesando 15 GB, decias... espera esto no es normal.
- Untrusted Sites and Free Web Applications/Software
Software que dice ser el original de adobe, pero tiene comportamiento anomalo, otro ejemplo pueden ser keygenerator, o medicinas.
- Downloading Files from the Internet
Hasta una plantila de un CV de word puede contener malware.
- Email Attachments
Adjuntos en correos.
- Network Propagation:
Abusado principalmente por gusanos, por ejemplo puertos de SMB sin parchear que permiten acceso sin necesidad de autenticarse.
- File shares:
Publicar un servicios de archivos claro que es un riesgo, simplmente es confiar mucho en que los usuarios no inyectaran codigo en un simple Word.
- Installation by other Malware
El propio malware tipicamente trae embebido otros modulos que corren despues de por ejemplo haber apagado el antimalware.
- Bluetooth and Wireless Networks
El propio medio de comunicación puede ser usado para tamperear comunicaciones e inyectar codigo.

### Medios web:

- Black Hat SEO: Rankear por medio del SEO paginas maliciosas, incluso arriba de las legitimas.
- Social Engineered Click-jacking: Hacer pasar botones de descarga o redirección como normales de la pagina web.
- Spear-phishing Sites: Sitios web clonados para robo de credenciales.
- Malvertising: Inyección de malware en ADs.
- Compromised Legitimate Websites: Inyección de codigo en paginas legitimas o usarlas de repositorio.
- Drive-by Downloads: Descargas no intencionadas, por ejemplo ingresar y que pida descargar un driver "necesario".
- Spam emails: Adjuntos malicioso.
- RTF Injection: Inyección de macros en archivos enriquecidos de texto.

## APT:
Advanced Persistence Threats son campañas con la principal función de daño empresarial y obtención de información sensible. Ej. tarjetas, usuarios, contraseñas, estrategias empresariales, etc.

- Objectives:
- Timeliness: Time between initial access and persistence
- Resources: TTPs
- Risk tolerance: Level up to which the attack remains undetected in the target’s network
- Actions: Predilecciones en evasión y ofuscación para permanecer oculto.
- Attack Origination Point: Varios puntos usados para acceso a una organización
- Numbers of devices Involved in the Attack: 
- Knowledge Source: 
- Multi-phased: Fases principalmente usadas, recon, osint, exfiltración, etc.
- Tailored to the Vulnerabilities: Preferencia por especificas vulnerabilidades
- Multiple Points of Entry: Creación de multiples backdoors.
- Evading Signature-Based Detection Systems: 
- Specific Warning Signs: 

### Ciclo de vida:
De forma simplificado la mayoria de los APT realizan:

- Preparation
- Initial Intrusion
- Expansion
- Persistence 
- Search and Exfiltration
- Cleanup

## Trojans:

### Types of trojans:
- Remote Access Trojans: RAT, software de acceso remoto que puede ser legitimo o malicioso.
  - njRAT
- Backdoor Trojans: Software que permite que el equipo reciba conexiones C2
  - poisonlvy
- Botnet Trojans
  - Necurs
- Rootkit Trojans
- E-Banking Trojans:
  - Componentes:
    - TAN Grabber: TAN (Transaction authentication number) son tokens de un solo uso para la autenticación de una transacción.
    - HTML Injection: Crear formularios maliciosos en paginas web para redireccionar datos sensibles.
    - Form grabber: Colecta Customer number and passwords enviados por parametros POST o GET.
    - Covert Credential Grabber: Permanecer oculto hasta que se entren a sitios de transacciones, en cada reinicio se mueven a diferentes partes del equipo hasta que no es el momento adecuado.
- Point-of-Sale Trojans
  - Malware que apunta a especificamente puntos de venta, su principal función es robar datos de tarjetas usadas en el punto de venta.
- Defacement Trojans
  - Como en los inicios del malware, que solo modificaban para molestar el aspecto de aplicaciones originales, usuando usando "user-styled custom applications", por ejemplo, modificar el tipo de fuente.
- Service Protocol Trojans
  - Abren servicios poco monitoreados, como instalar un servidor http, https, VNC, ICMP, que cuando se le comunique cierta información respondera, ejemplo de servidor icmp que permite enviar archivos:
    - https://github.com/gwen001/icmp-send-file
- Mobile Trojans
- IoT Trojans
- Security Software Disabler Trojans:
  - Especificamente su tarea es apagar la seguridad en el dispositivo
- Destructive Trojans:
  - Su objetivo es destruir el sistema, borrando registros clave, archivos de forma random, etc.
- DDoS Attack Trojans
- Command Shell Trojan

### Virus:
"self-replicating program"

- Proceso de creación:
1- Design
2- Replication:
  - Infected files
  - File shares
  - Media removable
  - Malicious download or attachments
3- Launch
4- Detection
5- Incorporation
6- Execution of the damage routine

### Types:
Tipos de virus.

1. System or Boot Sector Virus: MBR Infection
2. File Virus: COM, EXE, SYS, OVL, OBJ, PRG, MNU, and BAT files.
3. Multipartite Virus: Combinación de ambas tecnicas.
4. Macro Virus: VBA, DOCX, etc.
5. Cluster Virus: Modifican el puntero de archivos originales, teniendo una solo copia del codigo en una localización.
6. Stealth/Tunneling Virus: Altering and corrupting the service call interrupts while running
7. Encryption Virus: Software que encripta su codigo, y que a ejecutarse lo descifra.
8. Sparse Infector Virus
9. Polymorphic Virus
10. Metamorphic Virus
11. Overwriting File or Cavity Virus
12. Companion Virus/Camouflage Virus
13. Shell Virus
14. File Extension Virus
15. FAT Virus
16. Logic Bomb Virus
17. Web Scripting Virus
18. Email Virus

### Proceso de infección:

1- Creación de paquete malicioso (Payload)
2- Implementarlo en una tecnicas de Dropper o Downloader
3- Uso de Wrapper para embebirlo a software autentico
  Ej. petite.exe, Graffiti.exe, IExpress Wizard, or eLiTeWrap, eLiTeWrap, Advanced File Joiner, Soprano 3, Exe2vbs y Kriptomatik
4- Usar crypter para ocultar el codigo malicioso
  BitCrypter, SwayzCryptor, Snip3, Babadeda, Aegis, Crypter 2.0, Hidden Sight Crypter, Battleship Crypter, HEAVEN CRYPTER y Cypherx
5- *Este es extra al CEH: Considero tambien ideal agregarle software de protección de lectura, detectan cuando un antimalware o dumpeador esta leyendo lo que hace el proceso y lo para.
6- Inyectarlo en el medio de propagación.
7- Enviar el medio a la victima.

### Creador de trojans automatizado:
El problema es que a menos de que el windows tenga todo apagado o sea un Win 7 ya no funcionan.

- DarkHorse Trojan Virus Maker
- Senna Spy Trojan Generator
- Batch Trojan Generator
- Umbra Loader
- Botnet Trojan Maker

### Exploits kits:
Son software maliciosos que automatizan el proceso de infección porque en automatico estan cargados con muchos exploits, donde buscan hasta encontrar con el adecuado.
Por ejemplo una pagina comprometida puede redireccionar a muchisimas paginas, y cada una tiene un payload en especifico, y cuando detecta que logro explotarse en automatico compromete el dispositivo.

- Ej. Lord, Underminer Exploit Kit, RIG Exploit kit, Magnitude, Angler, Neutrino, Terror, Sundown
































